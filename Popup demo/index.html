<html>
<head>
<title>Pop up demo</title>
</head>
<body>
<script>
var wref = null;
function closeWindow()
{
	if(wref != null){
		wref.close();
	}
	wref = null;
}
window.onfocus = function()
{
	if(wref != null && typeof wref.window === 'object'){
		console.log('onfocus, setting focus on window.');
		window.setTimeout(function ()
		{
			if(wref != null)wref.focus();
		}, 0);
		window.setTimeout(function ()
		{
			if(wref != null)wref.focus();
		}, 100);
	}else {
		console.log('onfocus, but not setting focus on window..');
	}
};

window.addEventListener("message", receiveMessage, false);

function receiveMessage(event) {
  console.log(event);
  if(event.data === 'CLOSE')
  {
	closeWindow();
  }
  if(event.data === 'ONCHANGE')
  {
	closeWindow();
  }
  
}
</script>
<script>
function PopupCenter(url, title, w, h, top) {
	if(wref != null && typeof wref.window === 'undefined')
	{
		console.log('setting wref to null');
		wref = null;
	}
	
	if(wref != null)
	{

		wref.focus();
		return;
	}
	
    // Fixes dual-screen position                         Most browsers      Firefox
    var dualScreenLeft = window.screenLeft != undefined ? window.screenLeft : window.screenX;
    var dualScreenTop = window.screenTop != undefined ? window.screenTop : window.screenY;

    var width = window.innerWidth ? window.innerWidth : document.documentElement.clientWidth ? document.documentElement.clientWidth : screen.width;
    var height = window.innerHeight ? window.innerHeight : document.documentElement.clientHeight ? document.documentElement.clientHeight : screen.height;

    var systemZoom = width / window.screen.availWidth;
	var left = (width - w) / 2 / systemZoom + dualScreenLeft;
    wref = window.open(url, title, 'scrollbars=yes, width=' + w / systemZoom + ', height=' + h / systemZoom + ', top=' + top + ', left=' + left);
    // Puts focus on the newWindow
    wref.focus();
}
</script>
<h1>Login via POP UP</h1>
<br/>
<button onclick="PopupCenter('popup.html','xtf','700','500', 200);">Login</button>
<button onclick="closeWindow();">Close</button>
</body>
</html>