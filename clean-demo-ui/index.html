<!doctype html>
<html class="no-js" lang="">

<head>
  <meta charset="utf-8">
  <title>Nets eID Broker</title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="apple-touch-icon" href="icon.png">

  <link rel="stylesheet" href="css/styles.css">

  <meta name="theme-color" content="#fafafa">
</head>

<body class="open">
  <div class="ie11-warning">
    <h1>This demo is not ready for IE11 yet. Please use Google Chrome.</h1>
  </div>
  <div class="popup-dialog">
    <div class="popup-background"></div>
    <div class="popup-content">
      <figure class="popup"></figure>
      <strong>Don’t see the secure MitID popup?</strong><p>We’ll help you re-launch the window</p>
      <button class="btn btn-main" onclick="popupwindow('signin.html', 'Sign in','400','588')">Reopen popup</button>
      <button class="btn" onclick="closeWindow()">Get back</button>
    </div>
  </div>
  <header>
    <figure class="logo"></figure>

  </header>
  <div class="content">
    <h1>
      The easy way to<br />to Open ID Connect
    </h1>
    <h4>This is an demonstration of how<br />
    Nets eID Broker can be used.</h4>
    <a class="btn btn-main btn-signin btn-lg" href="signin.html"> Sign in with redirect</a>
    <a class="btn btn-main btn-signin btn-lg" onclick="popupwindow('signin.html', 'Sign in','400','588')"> Sign in with pop-up</a>

    <div class="help" id="helpbox-01">
      <div class="help-box">
        <figure class="info"></figure>
        <h2>Quick demonstation<br /> of MitID integration</h2>
        <p>Here you can choose between the two types of windows for MitID: Redirect or popup</p>
      </div>
      <div id="arrow-01-01" class="arrow-up"></div>
      <div id="arrow-01-02" class="arrow-up"></div>
    </div>
  </div>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

  <script>
    $( document ).ready(function() {
      function GetIEVersion() {
        var sAgent = window.navigator.userAgent;
        var Idx = sAgent.indexOf("MSIE");

        // If IE, return version number.
        if (Idx > 0) 
          return parseInt(sAgent.substring(Idx+ 5, sAgent.indexOf(".", Idx)));

        // If IE 11 then look for Updated user agent string.
        else if (!!navigator.userAgent.match(/Trident\/7\./)) 
          return 11;

        else
          return 0; //It is not IE
      }

      if (GetIEVersion() > 0){
        $('body').addClass("ie11");
      }
    });


    var wref = null;
    function closeWindow() {
        if (wref != null) {
            console.log('window.close()');
            wref.close();
            $("body").removeClass("popup-active");
        }
        wref = null;
    }
    window.onfocus = function () {
        if (wref != null && typeof wref.window === 'object') {
            console.log('onfocus, setting focus on window.');
            window.setTimeout(function () {
              wref.focus();
            }, 100);
            /*window.setTimeout(function () {
                if (wref != null) wref.focus();
            }, 100);*/
        } else {
            console.log('onfocus, but not setting focus on window..');
        }
    };

    window.addEventListener("message", receiveMessage, false);

    function receiveMessage(event) {
        console.log(event);
        if (event.data === 'CLOSE') {
            console.log('data == CLOSE, closing window..');
            closeWindow();
        }else if (event.data === 'ONCHANGE') {
            closeWindow();
        }else if(event.data === 'REDIRECT'){
            window.location.replace("netbank-popup.html")
        }

    }

    function popupwindow(url, title, w, h) {
        $("body").addClass("popup-active");
        var y = window.outerHeight / 2 + window.screenY - (h / 2)
        var x = window.outerWidth / 2 + window.screenX - (w / 2)
        wref = window.open(url, title, 'toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width=' + w + ', height=' + h + ', top=' + y + ', left=' + x);
        wref.focus();
    }

</script>

</body>

</html>
